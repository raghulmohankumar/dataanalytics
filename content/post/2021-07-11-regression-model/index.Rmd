---
title: "Regression Model"
author: ''
date: '2021-07-11'
slug: regression-model
categories: []
tags: []
---

## Load Packages

```{r warning=FALSE,echo=FALSE,message=FALSE}
library(tidyverse)
library(tidymodels)
library(ggplot2)
library(GGally)
library(dplyr)
library(psych)
library(Hmisc)
library(memisc)
library(pastecs)
library(rstatix)
library(bivariate)
library(ggtext)
library(scorecardModelUtils)
library(scatterplot3d)
library(knitr)
library(readxl)
library(ggdark)
library(kableExtra)
library(gridExtra)
library(MASS)
library(bitops)
library(RCurl)
library(ggcorrplot)
set.seed(1234)
options(dplyr.print_min = 10, dplyr.print_max = 6)
```

## Import Dataset : Diamond data

```{r warning=FALSE,echo=FALSE,message=FALSE}

pp <- read_excel("MBA6636_SM21_Professor_Proposes_Data.xlsx", na = c("n/a", "", "NA"))
```

## Summary Statistics

```{r warning=FALSE,echo=FALSE,message=FALSE}
summary(pp)
```



## Univariate Analysis

```{r warning=FALSE,echo=FALSE,message=FALSE}
describe(pp)
stat.desc(pp)
hist.data.frame(pp)

ggplot(pp, aes(x=Carat, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) + 
  labs(x = 'Carat', y='Price(CAD)') +ggtitle("Scatter Plot Carat vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(pp, aes(x=Cut, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) + 
  labs(x = 'Cut', y='Price(CAD)') +ggtitle("Scatter Plot Cut vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(pp, aes(x=Clarity, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) + 
  labs(x = 'Clarity', y='Price(CAD)') +ggtitle("Scatter Plot Clarity vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(pp, aes(x=Colour, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) + 
  labs(x = 'Colour', y='Price(CAD)') +ggtitle("Scatter Plot Colour vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(pp, aes(x=Certification, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) +   labs(x = 'Certification', y='Price(CAD)') +ggtitle("Scatter Plot Certification vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(pp, aes(x=Polish, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) +   labs(x = 'Polish', y='Price(CAD)') +ggtitle("Scatter Plot Polish vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(pp, aes(x=Symmetry, y= as.numeric(Price), color = (Price >= 1000))) + geom_point(show.legend = FALSE) +   labs(x = 'Symmetry', y='Price(CAD)') +ggtitle("Scatter Plot Symmetry vs Price")+  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

## Bivariate Analysis - Correlation and Covariance

```{r warning=FALSE,echo=FALSE,message=FALSE}

data(pp)
cat("The Correlation between Carat and Price is",cor(pp$Carat, pp$Price, use="complete.obs"),"\n")
df <- dplyr::select_if(pp, is.numeric)
r <- cor(df, use="complete.obs")
round(r,2)
ggcorrplot(r)
cat("As per the default method,","The Covariance between Carat and Price is",cov(pp$Carat, pp$Price),"\n")
cat("As per the Pearson method,","The Covariance between Carat and Price is",cov(pp$Carat, pp$Price, method = "pearson"),"\n")
cat("As per the Kendall method,","The Covariance between Carat and Price is",cov(pp$Carat, pp$Price, method = "kendall"),"\n")
cat("As per the Kendall method,","The Covariance between Carat and Price is",cov(pp$Carat, pp$Price, method = "spearman"),"\n")

```
## Goal: Predict Price from Carat

```{r warning=FALSE,echo=FALSE,message=FALSE}
ggplot(data = pp, aes(x = Carat, y = Price)) + geom_point() + geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") + labs( title = "Price vs. Carat", subtitle = "Price Predition of Diamonds", x = "Carat", y = "Price (CAD)")
```
## Splitting the dataset into 2 datasets based on the pricing

```{r warning=FALSE,echo=FALSE,message=FALSE}
pp1 <- pp %>% filter(Price <=1000)
pp2 <- pp %>% filter(Price >1000)
ggplot(data = pp1, aes(x = Carat, y = Price)) + geom_point() + geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") + labs( title = "Price vs. Carat", subtitle = "Price Predition of Diamonds", x = "Carat", y = "Price (CAD)")
ggplot(data = pp2, aes(x = Carat, y = Price)) + geom_point() + geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") + labs( title = "Price vs. Carat", subtitle = "Price Predition of Diamonds", x = "Carat", y = "Price (CAD)")
```



## Build Simple regression model

```{r warning=FALSE,echo=FALSE,message=FALSE}

linearmod <- lm(I(log(Price)) ~ I(Carat^(1/3)), data = pp)
summary(linearmod)
```
## Build multiple regression model

```{r warning=FALSE,echo=FALSE,message=FALSE}

multiple_model <- lm(Price ~ Carat + Colour + Cut + Clarity + Polish + Symmetry + Certification, data = pp)
summary(multiple_model)
```

## Build mtable

```{r warning=FALSE,echo=FALSE,message=FALSE}
m1 <- lm(I(log(Price)) ~ I(Carat^(1/3)), data = pp)
m2 <- update(m1, ~ . + Carat)
m3 <- update(m2, ~ . + Cut)
m4 <- update(m3, ~ . + Colour)
m5 <- update(m4, ~ . + Clarity)
m6 <- update(m5, ~ . + Polish)
m7 <- update(m6, ~ . + Symmetry)
m8 <- update(m7, ~ . + Certification)
mtable(m1, m2, m3, m4, m5,m6,m7,m8,sdigits = 3)
```

## Predict the price of the Professorâ€™s Diamond Ring of his interest

```{r warning=FALSE,echo=FALSE,message=FALSE}
thisDiamond = data.frame(Carat = 0.9, Cut = "V", Colour = "J", Clarity="SI2", Polish="G", Symmetry="V", Certification="GIA")
modelEstimate = predict(m8, newdata = thisDiamond, interval="prediction", level = .95) 
exp(modelEstimate)
```